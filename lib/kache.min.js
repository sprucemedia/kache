/*
Kache - a cross-browser LocalStorage API
https://github.com/leveille/kache
Version: 0.0.5
*/((function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s=Object.prototype.hasOwnProperty,t=Array.prototype.slice,u=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(b in this&&this[b]===a)return b;return-1},v=function(a,b){function d(){this.constructor=a}for(var c in b)s.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};m=typeof exports!="undefined"&&exports!==null?exports:this,j=function(a){return typeof a=="number"&&isFinite(a)},i=function(a){return a&&a.e&&a.e<n()},l=function(){},n=function(){return+(new Date)},h=function(a){var b,c,d;d=0;for(b in a){if(!s.call(a,b))continue;c=a[b],d++}return d},a={enabled:!1,defaultTimeout:0,namespacePrefix:"",Timeouts:{}},m.KacheConfig?((o=m.KacheConfig).enabled==null&&(o.enabled=a.enabled),(p=m.KacheConfig).defaultTimeout==null&&(p.defaultTimeout=a.defaultTimeout),(q=m.KacheConfig).namespacePrefix==null&&(q.namespacePrefix=a.namespacePrefix),(r=m.KacheConfig).Timeouts==null&&(r.Timeouts=a.Timeouts)):m.KacheConfig=a,d={trace:!0,logPrefix:"(Kache)",log:function(){var a;a=1<=arguments.length?t.call(arguments,0):[];if(!this.trace)return;if(typeof console=="undefined")return;return this.logPrefix&&a.unshift(this.logPrefix),console.log.apply(console,a),this}},k=["included","extended"],f=function(){function a(){}return a.include=function(a){var b,c,d;if(!a)throw"include(obj) requires obj";for(c in a)d=a[c],u.call(k,c)<0&&(this.prototype[c]=d);return b=a.included,b&&b.apply(this),this},a.extend=function(a){var b,c,d;if(!a)throw"extend(obj) requires obj";for(c in a)d=a[c],u.call(k,c)<0&&(this[c]=d);return b=a.extended,b&&b.apply(this),this},a.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a.prototype.proxy=function(a){var b=this;return function(){return a.apply(b,arguments)}},a}(),g=function(a){function b(a){var b;this.attrs&&this.load(this.attrs),a.logPrefix&&(this.logPrefix=a.logPrefix),m.KacheConfig.namespacePrefix&&this.disablePrefix!==!0&&(this.namespace=m.KacheConfig.namespacePrefix+"#"+this.namespace);if(!a.load)throw"Cannot load cache store";this._=a.load();if(!this._)throw"Invalid Cache Instance";m.KacheConfig&&(m.KacheConfig.Timeouts&&m.KacheConfig.Timeouts[this.namespace]?b=m.KacheConfig.Timeouts[this.namespace]:m.KacheConfig.defaultTimeout?b=m.KacheConfig.defaultTimeout:b=0),this.timeout==null&&(this.timeout=b)}return v(b,a),b.include(d),b.prototype.clear=function(){return this._={},this.writeThrough(),this},b.prototype.clearExpired=function(a){return i(this._[a])&&this.remove(a),this},b.prototype.clearExpireds=function(){var a,b,c;c=this._;for(b in c)a=c[b],this.clearExpired(b);return this},b.prototype.count=function(){return this.clearExpireds(),h(this._)},b.prototype.dump=function(){return this.log(this._),this},b.prototype.enabled=function(){throw"NotImplemented exception"},b.prototype.error=function(a){return this.log(a)},b.prototype.get=function(a){if(!this.enabled())return;this.clearExpired(a);if(this._[a]&&this._[a].v)return this._[a].v},b.prototype.load=function(a){var b,c,d;d=[];for(b in a)c=a[b],d.push(this[b]=c);return d},b.prototype.remove=function(a){return delete this._[a],this.writeThrough(),this},b.prototype.set=function(a,b,c){var d;this.clearExpireds(),c==null&&(c=this.timeout),j(c)&&c!==0&&(d=n()+c);try{this._[a]={v:b,e:d||0,t:c},this.writeThrough()}catch(e){this.error(e),b=null}return b},b.prototype.toString=function(){return""+this.namespace+" : "+this.timeout},b.prototype.writeThrough=function(){return l(),this},b}(f),e=function(a){function c(a,b,d){var e;this.namespace=a,this.timeout=b,this.attrs=d,e={load:this.proxy(function(){var a,b,c;return(c=(a=this.store)[b=this.namespace])!=null?c:a[b]={}}),logPrefix:"MemoryStore"},c.__super__.constructor.call(this,e)}var b;return v(c,a),m._kache==null&&(m._kache=b={store:{},enabled:m.KacheConfig.enabled}),c.kache=m._kache,c.clearExpireds=function(){var a,b,c,d,e,f,g;g=this.store;for(c in g){if(!s.call(g,c))continue;f=g[c],e=this.store[c];for(d in e)b=e[d],i(b)&&(a=!0,delete b);a&&(this.store[c]=e,h(this.store[c])===0&&delete this.store[c])}return this},c.clearStore=function(){return this.store={},this},c.disable=function(){return m._kache.enabled=!1,this},c.enable=function(){return m._kache.enabled=!0,this},c.isEnabled=function(){return!!(m._kache&&m._kache.enabled||m.KacheConfig&&m.KacheConfig.enabled||!1)},c.validStore=function(){return!0},c.prototype.store=m._kache.store,c.prototype.enabled=function(){return!!c.isEnabled()},c}(g),c=function(a){function c(a,b,d){var e;this.namespace=a,this.timeout=b,this.attrs=d;if(!c.validStore())throw"LocalStorage is not a valid cache store";e={load:this.proxy(function(){return JSON.parse(this.store[this.namespace]||"{}")}),logPrefix:"LocalStore"},c.__super__.constructor.call(this,e)}var b;return v(c,a),b="_kache_enabled",c.clearStore=function(){var a;return localStorage[b]!==void 0&&(a=this.isEnabled()),localStorage.clear(),a!==void 0&&(localStorage[b]=a),this},c.clearExpireds=function(){var a,b,c,d,e,f,g;f=this.store;for(d in f){if(!s.call(f,d))continue;e=f[d],g=JSON.parse(e);for(c in g){b=g[c],i(b)&&(a=!0,delete b);if(a&&h(e)===0){delete e;return}e==null&&(e={}),this.store[d]=JSON.stringify(e)}}return this},c.enable=function(){return localStorage[b]="true",this},c.disable=function(){return localStorage[b]="false",this},c.isEnabled=function(){return!!(localStorage[b]&&localStorage[b]==="true"||m.KacheConfig&&m.KacheConfig.enabled||!1)},c.validStore=function(){try{return!!localStorage}catch(a){return!1}},c.prototype.store=localStorage,c.prototype.enabled=function(){return!!c.isEnabled()},c.prototype.error=function(a){a==="QUOTA_EXCEEDED_ERR"?(this.log("QUOTA_EXCEEDED_ERR"),this.clearExpireds()):c.__super__.error.call(this,a)},c.prototype.writeThrough=function(){return this.store[this.namespace]=JSON.stringify(this._),this},c}(g),b=c.validStore()?c:e,m.Kache=function(a,c,d){return new b(a,c,d)},m.Kache.Local=c,m.Kache.Memory=e,m.Kache.clearStore=b.clearStore,m.Kache.clearExpireds=b.clearExpireds,m.Kache.disable=b.disable,m.Kache.enable=b.enable,m.Kache.isEnabled=b.isEnabled,m.Kache.__version__="0.0.5"})).call(this);